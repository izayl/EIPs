(window.webpackJsonp=window.webpackJsonp||[]).push([[711],{1136:function(t,e,a){"use strict";a.r(e);var s=a(46),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"simple-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary"}},[t._v("#")]),t._v(" Simple Summary")]),t._v(" "),a("p",[t._v("Allows contract accounts to store gas that can be transferred to the refund counter.")]),t._v(" "),a("h2",{attrs:{id:"abstract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[t._v("#")]),t._v(" Abstract")]),t._v(" "),a("p",[t._v("Contracts can persist gas for later transfer to the refund counter. Three opcodes are introduced to read, add to, and use this gas counter.")]),t._v(" "),a("h2",{attrs:{id:"motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#motivation"}},[t._v("#")]),t._v(" Motivation")]),t._v(" "),a("p",[t._v("The refund mechanism is currently being used by gas tokens to arbitrage gas price. This brings gas supply elasticity and price stability by moving gas from blocks with less demand to blocks with more demand. Unfortunately this rewards unnecessary state growth. By introducing a superior gas storage mechanism, the gas market will require less storage and computation.")]),t._v(" "),a("h2",{attrs:{id:"specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[t._v("#")]),t._v(" Specification")]),t._v(" "),a("p",[t._v("Contract accounts gain an unsigned gas refund counter, initially zero.")]),t._v(" "),a("p",[t._v("Three new opcodes are introduced to manage this state.")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("SELFGAS")]),t._v(" ("),a("code",[t._v("0x49")]),t._v("): Pushes the current account's gas refund counter onto the stack. Shares gas pricing with "),a("code",[t._v("SELFBALANCE")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("USEGAS")]),t._v(" ("),a("code",[t._v("0x4a")]),t._v("): Pops "),a("code",[t._v("amount")]),t._v(" from the stack. The minimum of "),a("code",[t._v("amount")]),t._v(" and the current account's gas refund counter is transferred to the execution context's refund counter. Costs "),a("code",[t._v("5000")]),t._v(" gas.")]),t._v(" "),a("li",[a("code",[t._v("STOREGAS")]),t._v(" ("),a("code",[t._v("0x4b")]),t._v("): Pops "),a("code",[t._v("amount")]),t._v(" from the stack. Costs "),a("code",[t._v("5000 + amount")]),t._v(" gas. Increases the current account's gas refund counter by "),a("code",[t._v("amount")]),t._v(".")])]),t._v(" "),a("h2",{attrs:{id:"rationale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rationale"}},[t._v("#")]),t._v(" Rationale")]),t._v(" "),a("p",[t._v("By reusing the execution context's refund counter we can reuse its 50% DoS protection, which limits its block elasticity contribution to 2x.")]),t._v(" "),a("p",[t._v("The gas costs are based on similar opcodes "),a("code",[t._v("SELFBALANCE")]),t._v(" and "),a("code",[t._v("SSTORE")]),t._v(".")]),t._v(" "),a("p",[t._v("Most accounts will store no gas, so the per-account storage overhead should be minimal or even zero in the normal case.")]),t._v(" "),a("p",[t._v("The opcode numbers chosen are in the same "),a("code",[t._v("0x4X")]),t._v(" range as "),a("code",[t._v("SELFBALANCE")]),t._v(" and "),a("code",[t._v("GASLIMIT")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"backwards-compatibility"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility"}},[t._v("#")]),t._v(" Backwards Compatibility")]),t._v(" "),a("p",[t._v("Because the gas is added to the refund counter, no compatibility issues are anticipated.")]),t._v(" "),a("h2",{attrs:{id:"test-cases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-cases"}},[t._v("#")]),t._v(" Test Cases")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Code")]),t._v(" "),a("th",[t._v("Used Gas")]),t._v(" "),a("th",[t._v("Refund")]),t._v(" "),a("th",[t._v("Original")]),t._v(" "),a("th",[t._v("Final")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("0x60004900")]),t._v(" "),a("td",[t._v("5003")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("0")])]),t._v(" "),a("tr",[a("td",[t._v("0x60034900")]),t._v(" "),a("td",[t._v("5003")]),t._v(" "),a("td",[t._v("2")]),t._v(" "),a("td",[t._v("2")]),t._v(" "),a("td",[t._v("0")])]),t._v(" "),a("tr",[a("td",[t._v("0x60034900")]),t._v(" "),a("td",[t._v("5003")]),t._v(" "),a("td",[t._v("3")]),t._v(" "),a("td",[t._v("3")]),t._v(" "),a("td",[t._v("0")])]),t._v(" "),a("tr",[a("td",[t._v("0x60034900")]),t._v(" "),a("td",[t._v("5003")]),t._v(" "),a("td",[t._v("3")]),t._v(" "),a("td",[t._v("4")]),t._v(" "),a("td",[t._v("1")])]),t._v(" "),a("tr",[a("td",[t._v("0x60034960034900")]),t._v(" "),a("td",[t._v("10006")]),t._v(" "),a("td",[t._v("4")]),t._v(" "),a("td",[t._v("4")]),t._v(" "),a("td",[t._v("0")])]),t._v(" "),a("tr",[a("td",[t._v("0x60034960034900")]),t._v(" "),a("td",[t._v("10006")]),t._v(" "),a("td",[t._v("6")]),t._v(" "),a("td",[t._v("6")]),t._v(" "),a("td",[t._v("0")])]),t._v(" "),a("tr",[a("td",[t._v("0x484900")]),t._v(" "),a("td",[t._v("5010")]),t._v(" "),a("td",[t._v("100000")]),t._v(" "),a("td",[t._v("100000")]),t._v(" "),a("td",[t._v("0")])]),t._v(" "),a("tr",[a("td",[t._v("0x61ffff4a00")]),t._v(" "),a("td",[t._v("70538")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("65535")])])])]),t._v(" "),a("h2",{attrs:{id:"security-considerations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#security-considerations"}},[t._v("#")]),t._v(" Security Considerations")]),t._v(" "),a("p",[t._v("DoS is already limited by the 50% refund limit.")]),t._v(" "),a("h2",{attrs:{id:"copyright"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copyright"}},[t._v("#")]),t._v(" Copyright")]),t._v(" "),a("p",[t._v("Copyright and related rights waived via "),a("a",{attrs:{href:"https://creativecommons.org/publicdomain/zero/1.0/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CC0"),a("OutboundLink")],1),t._v(".")])])}),[],!1,null,null,null);e.default=r.exports}}]);