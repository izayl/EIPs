(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{345:function(e,t,s){e.exports=s.p+"assets/img/permissions.070f7d34.png"},346:function(e,t,s){e.exports=s.p+"assets/img/facebook_permissions.67ce0f1c.png"},347:function(e,t,s){e.exports=s.p+"assets/img/log_in_with_apple.93199b9f.jpeg"},616:function(e,t,s){"use strict";s.r(t);var a=s(46),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[a("img",{attrs:{src:s(345),alt:"Sample prompt screenshot"}})]),e._v(" "),a("h2",{attrs:{id:"simple-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary"}},[e._v("#")]),e._v(" Simple Summary")]),e._v(" "),a("p",[e._v('A proposed standard interface for restricting and permitting access to security-sensitive methods within a restricted web3 context like a website or "dapp".')]),e._v(" "),a("h2",{attrs:{id:"abstract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[e._v("#")]),e._v(" Abstract")]),e._v(" "),a("p",[e._v("Web3 JavaScript wallet browsers may implement "),a("code",[e._v("wallet_getPermissions")]),e._v(" and "),a("code",[e._v("wallet_requestPermissions")]),e._v(". This provides a standard interface for requesting permissions and checking a domain's current permissions status.")]),e._v(" "),a("h2",{attrs:{id:"motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#motivation"}},[e._v("#")]),e._v(" Motivation")]),e._v(" "),a("p",[e._v("Web3 Wallets are built around the responsibility of mediating the interactions between untrusted applications and a user's keys on their computer, getting appropriate consent from the user.")]),e._v(" "),a("p",[e._v("Today web3 browsers like MetaMask always prompt on a per-action basis. This provides security at the cost of substantial user friction. We believe that a single permissions request can achieve the same level of security with vastly improved UX.")]),e._v(" "),a("p",[e._v("The pattern of permissions requests is common around the web, from login with Facebook, Twitter, GitHub, and even Apple, making it a very familiar pattern.")]),e._v(" "),a("details",[a("summary",[e._v("Facebook Permissions")]),e._v(" "),a("img",{attrs:{src:s(346),alt:"Facebook Permissions"}})]),e._v(" "),a("details",[a("summary",[e._v("Log in With Apple")]),e._v(" "),a("img",{attrs:{src:s(347),alt:"Log in With Apple"}})]),e._v(" "),a("p",[e._v("Many web3 applications today begin their sessions with a series of repetitive requests:")]),e._v(" "),a("ul",[a("li",[e._v("Reveal your wallet address to this site.")]),e._v(" "),a("li",[e._v("Switch to a preferred network.")]),e._v(" "),a("li",[e._v("Sign a cryptographic challenge.")]),e._v(" "),a("li",[e._v("Grant a token allowance to our contract.")]),e._v(" "),a("li",[e._v("Send a transaction to our contract.")])]),e._v(" "),a("p",[e._v("Many of these (and possibly all), and many more (like decryption), could be generalized into a set of human-readable permissions prompts on the original sign-in screen, and additional permissions could be requested only as needed.")]),e._v(" "),a("p",[e._v("On the user's end, each of these permissions could be individually rejected (unchecked), or even "),a("em",[e._v("attenuated")]),e._v(", or adjusted to meet the user's terms (for example, a sign-in request could have a user-added expiration date, and a token allowance could be adjusted by the user when it is requested), making the web3 login a sort of user-revisable terms of use.")]),e._v(" "),a("h2",{attrs:{id:"specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[e._v("#")]),e._v(" Specification")]),e._v(" "),a("p",[e._v("This proposal adds two new methods to a wallet's web3 provider API:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("wallet_getPermissions")])]),e._v(" "),a("li",[a("code",[e._v("wallet_requestPermissions")])])]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("wallet_getPermissions")]),e._v(" method is used for getting an array of current permissions (empty by default), while the "),a("code",[e._v("wallet_requestPermissions")]),e._v(" method is used for an application to request additional permissions.")]),e._v(" "),a("p",[e._v('These two methods are used to restrict a few hypothetical "restricted methods". The first such method we would suggest should be included as part of the standard is '),a("code",[e._v("eth_accounts")]),e._v(".")]),e._v(" "),a("p",[e._v("In this framework, the permission for a user to reveal their accounts would look like this:")]),e._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" response "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("await")]),e._v(" provider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("request")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  method"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'wallet_requestPermissions'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  params"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'eth_accounts'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("p",[e._v("If this request was rejected, it would throw an error with a "),a("code",[e._v("code")]),e._v(" value equal to "),a("code",[e._v("4001")]),e._v(", per "),a("RouterLink",{attrs:{to:"/eip-1193.html"}},[e._v("EIP-1193 errors")]),e._v(", which the MetaMask team has canonized in a module "),a("a",{attrs:{href:"https://github.com/metamask/eth-rpc-errors",target:"_blank",rel:"noopener noreferrer"}},[e._v("eth-rpc-errors"),a("OutboundLink")],1),e._v(".")],1),e._v(" "),a("p",[e._v("If the request is accepted by the user, then subsequent requests to "),a("code",[e._v("eth_accounts")]),e._v(" will succeed, and return an accounts array as usual.")]),e._v(" "),a("p",[e._v("A call to "),a("code",[e._v("wallet_getPermissions")]),e._v(" will then return a permissions schema object that describes the current permission.")]),e._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" response "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("await")]),e._v(" provider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("request")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  method"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'wallet_getPermissions'")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("Would return a value something like this:")]),e._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    invoker"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" 'ens"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//your-site.eth',")]),e._v("\n    parentCapability"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" 'eth_accounts'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    caveats"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        type"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" 'filterResponse'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x0c54fccd2e384b4bb6f2e405bf5cbc15a017aafb"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br")])]),a("p",[e._v("Where "),a("code",[e._v("invoker")]),e._v(" is a unique domain string used to identify the source of the current dapp. To start, this may include only "),a("code",[e._v("https")]),e._v(" prefixes, but "),a("code",[e._v("ens")]),e._v(", "),a("code",[e._v("swarm")]),e._v(", "),a("code",[e._v("ipfs")]),e._v(", and others may all be valid sources in the future.")]),e._v(" "),a("p",[e._v("The term "),a("code",[e._v("parentCapability")]),e._v(" comes from the "),a("a",{attrs:{href:"https://w3c-ccg.github.io/zcap-ld/",target:"_blank",rel:"noopener noreferrer"}},[e._v("zcap-ld spec"),a("OutboundLink")],1),e._v(", which these permissions objects are based on, and refers to the method that is being permitted.")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("caveats")]),e._v(" array represents the specific restrictions applied to the permitted method.")]),e._v(" "),a("p",[e._v("You can see above how internally the user-selected account is transformed into a "),a("a",{attrs:{href:"https://github.com/MetaMask/json-rpc-capabilities-middleware/blob/master/src/%40types/ocap-ld.d.ts#L28-L33",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("caveat")]),a("OutboundLink")],1),e._v(", which is a restriction on the response values, in this case ensuring the page can only be notified of approved accounts. This also means this permissions system is forward-extensible to support logging into a page with multiple accounts.")]),e._v(" "),a("h2",{attrs:{id:"rationale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rationale"}},[e._v("#")]),e._v(" Rationale")]),e._v(" "),a("p",[e._v("While the current model of getting user consent on a per-action basis has high security, there are huge usability gains to be had bo getting more general user consent which can cover broad categories of usage, which can be expressed in a more human-readable way. This pattern has a variety of benefits to offer different functions within a web3 wallet.")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("eth_sendTransaction")]),e._v(" method itself could be a restricted method (requested by default with the "),a("code",[e._v("provider.enable()")]),e._v(" method), and the user could at sign-in time decide whether they wanted to require confirmations, approve all transactions, or only approve transactions to a certain contract, or up to a certain token limit, for example. By restricting this method by default, wallets could prevent sites from spamming the user with popups.")]),e._v(" "),a("p",[e._v("If "),a("code",[e._v("eth_call")]),e._v(" were a restricted method, then random websites would not be able to drain a user's subscription to a hosted provider, making it easier to protect services like Infura against DDoS attacks.")]),e._v(" "),a("p",[e._v("On-chain actions could be represented as a permission under this model, for example, the permission to send an allowance-setting transaction to a specific token address is virtually equivalent to the approval of that transaction, except the site could choose to only invoke the transaction when it was needed. This could allow a standard interface for applications to request permissions which may require different actions depending on different types of accounts (hot wallets, hardware wallets, cold wallets, contract accounts).")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("requestPermissions")]),e._v(" method could be expanded to include other options related to the requested permissions, for example, sites could request accounts with specific abilities. For example, a website like an exchange that requires "),a("code",[e._v("signTypedData_v3")]),e._v(" (which is not supported by some hardware wallets), might want to specify that requirement, maybe like this:")]),e._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[e._v("provider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("request")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  method"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'requestPermissions'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  params"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'eth_accounts'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        requiredMethods"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'signTypedData_v3'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br")])]),a("p",[e._v("This would allow the wallet to limit the user's options to valid ones, and allows dapps to ensure selected accounts are compatible with their service, while preserving the user's privacy regarding how they are storing their keys.")]),e._v(" "),a("h2",{attrs:{id:"implementation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implementation"}},[e._v("#")]),e._v(" Implementation")]),e._v(" "),a("p",[e._v("MetaMask uses EIP-2255 to restrict the "),a("code",[e._v("eth_accounts")]),e._v(" RPC method such that it will return an empty array to any caller that has not been granted the corresponding permission.")]),e._v(" "),a("p",[e._v("You can get more detailed API and type information "),a("a",{attrs:{href:"https://github.com/MetaMask/rpc-cap#rpc-methods",target:"_blank",rel:"noopener noreferrer"}},[e._v("on the RpcCap repository's readme"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("New hypothetical and proposed permissions can be easily added to "),a("a",{attrs:{href:"https://github.com/MetaMask/metamask-extension/blob/76a2a9b/app/scripts/controllers/permissions/restrictedMethods.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("the "),a("code",[e._v("restrictedMethods")]),e._v(" in the MetaMask permissions controller"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"copyright"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copyright"}},[e._v("#")]),e._v(" Copyright")]),e._v(" "),a("p",[e._v("Copyright and related rights waived via "),a("a",{attrs:{href:"https://creativecommons.org/publicdomain/zero/1.0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("CC0"),a("OutboundLink")],1),e._v(".")])])}),[],!1,null,null,null);t.default=n.exports}}]);