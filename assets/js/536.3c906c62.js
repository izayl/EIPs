(window.webpackJsonp=window.webpackJsonp||[]).push([[536],{949:function(t,e,a){"use strict";a.r(e);var s=a(46),i=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("ℹ️ "),a("strong",[t._v("[EIP-2200] has superseded [EIP-1706].")]),t._v(" ℹ️")])]),t._v(" "),a("h2",{attrs:{id:"simple-summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary"}},[t._v("#")]),t._v(" Simple Summary")]),t._v(" "),a("p",[t._v("The proposal that had been accepted changes security properties of a large portion of an existing contract code base that may be infeasible to update and validate. This proposal will make the old assumptions hold even after a network upgrade.")]),t._v(" "),a("h2",{attrs:{id:"abstract"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[t._v("#")]),t._v(" Abstract")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/zh/eip-1283.html"}},[t._v("EIP-1283")]),t._v(" significantly lowers the gas costs of writing to contract's storage. This created a danger of a new kind of reentrancy attacks on existing contracts as Solidity by default grants a 'stipend' of 2300 gas to simple transfer calls. This danger is easily mitigated if SSTORE is not allowed in low gasleft state, without breaking the backward compatibility and the original intention of this EIP.")],1),t._v(" "),a("h2",{attrs:{id:"motivation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#motivation"}},[t._v("#")]),t._v(" Motivation")]),t._v(" "),a("p",[t._v("An attack that is described in "),a("a",{attrs:{href:"https://medium.com/chainsecurity/constantinople-enables-new-reentrancy-attack-ace4088297d9",target:"_blank",rel:"noopener noreferrer"}},[t._v("this article"),a("OutboundLink")],1),t._v(". Explicitly specifying the call stipend as an invariant will have a positive effect on Ethereum protocol security: https://www.reddit.com/r/ethereum/comments/agdqsm/security_alert_ethereum_constantinople/ee5uvjt")]),t._v(" "),a("h2",{attrs:{id:"specification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#specification"}},[t._v("#")]),t._v(" Specification")]),t._v(" "),a("p",[t._v("Add the following condition to to the SSTORE opcode gas cost calculation:")]),t._v(" "),a("ul",[a("li",[t._v("If "),a("em",[t._v("gasleft")]),t._v(" is less than or equal to 2300, fail the current call frame with 'out of gas' exception.")])]),t._v(" "),a("h2",{attrs:{id:"rationale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rationale"}},[t._v("#")]),t._v(" Rationale")]),t._v(" "),a("p",[t._v("In order to keep in place the implicit reentrancy protection of existing contracts, transactions should not be allowed to modify state if the remaining gas is lower then the 2300 stipend given to 'transfer'/'send' in Solidity. These are other proposed remediations and objections to implementing them:")]),t._v(" "),a("ul",[a("li",[t._v("Drop EIP-1283 and abstain from modifying SSTORE cost\n"),a("ul",[a("li",[t._v("EIP-1283 is an important update")]),t._v(" "),a("li",[t._v("It was accepted and implemented on test networks and in clients.")])])]),t._v(" "),a("li",[t._v("Add a new call context that permits LOG opcodes but not changes to state.\n"),a("ul",[a("li",[t._v("Adds another call type beyond existing regular/staticcall")])])]),t._v(" "),a("li",[t._v("Raise the cost of SSTORE to dirty slots to >=2300 gas\n"),a("ul",[a("li",[t._v("Makes net gas metering much less useful.")])])]),t._v(" "),a("li",[t._v("Reduce the gas stipend\n"),a("ul",[a("li",[t._v("Makes the stipend almost useless.")])])]),t._v(" "),a("li",[t._v("Increase the cost of writes to dirty slots back to 5000 gas, but add 4800 gas to the refund counter\n"),a("ul",[a("li",[t._v("Still doesn’t make the invariant explicit.")]),t._v(" "),a("li",[t._v("Requires callers to supply more gas, just to have it refunded")])])]),t._v(" "),a("li",[t._v("Add contract metadata specifying per-contract EVM version, and only apply SSTORE changes to contracts deployed with the new version.")])]),t._v(" "),a("h2",{attrs:{id:"backwards-compatibility"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility"}},[t._v("#")]),t._v(" Backwards Compatibility")]),t._v(" "),a("p",[t._v("Performing SSTORE has never been possible with less than 5000 gas, so it does not introduce incompatibility to the Ethereum mainnet. Gas estimation should account for this requirement.")]),t._v(" "),a("h2",{attrs:{id:"test-cases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-cases"}},[t._v("#")]),t._v(" Test Cases")]),t._v(" "),a("p",[t._v("Test cases for an implementation are mandatory for EIPs that are affecting consensus changes. Other EIPs can choose to include links to test cases if applicable. TODO")]),t._v(" "),a("h2",{attrs:{id:"implementation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implementation"}},[t._v("#")]),t._v(" Implementation")]),t._v(" "),a("p",[t._v("TODO")]),t._v(" "),a("h2",{attrs:{id:"copyright"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copyright"}},[t._v("#")]),t._v(" Copyright")]),t._v(" "),a("p",[t._v("Copyright and related rights waived via "),a("a",{attrs:{href:"https://creativecommons.org/publicdomain/zero/1.0/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CC0"),a("OutboundLink")],1),t._v(".")])])}),[],!1,null,null,null);e.default=i.exports}}]);